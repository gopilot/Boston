var http=require("http"),res=http.ServerResponse.prototype,setHeader=res.setHeader,_renderHeaders=res._renderHeaders,writeHead=res.writeHead;res._hasConnectPatch||(res.__defineGetter__("headerSent",function(){return this._header}),res.setHeader=function(e,t){var n,r=e.toLowerCase();return this._headers&&"set-cookie"==r?(n=this.getHeader(e))&&(t=Array.isArray(n)?n.concat(t):[n,t]):"content-type"==r&&this.charset&&(t+="; charset="+this.charset),setHeader.call(this,e,t)},res._renderHeaders=function(){return this._emittedHeader||this.emit("header"),this._emittedHeader=!0,_renderHeaders.call(this)},res.writeHead=function(){return this._emittedHeader||this.emit("header"),this._emittedHeader=!0,writeHead.apply(this,arguments)},res._hasConnectPatch=!0);