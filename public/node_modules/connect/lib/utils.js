var http=require("http"),crypto=require("crypto"),parse=require("url").parse,signature=require("cookie-signature");exports.mime=function(e){var t=e.headers["content-type"]||"";return t.split(";")[0]},exports.error=function(e,t){var n=new Error(t||http.STATUS_CODES[e]);return n.status=e,n},exports.md5=function(e,t){return crypto.createHash("md5").update(e).digest(t||"hex")},exports.merge=function(e,t){if(e&&t)for(var n in t)e[n]=t[n];return e},exports.escape=function(e){return String(e).replace(/&(?!\w+;)/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},exports.uid=function(e){return crypto.randomBytes(Math.ceil(3*e/4)).toString("base64").slice(0,e)},exports.sign=function(e,t){return console.warn("do not use utils.sign(), use https://github.com/visionmedia/node-cookie-signature"),e+"."+crypto.createHmac("sha256",t).update(e).digest("base64").replace(/=+$/,"")},exports.unsign=function(e,t){console.warn("do not use utils.unsign(), use https://github.com/visionmedia/node-cookie-signature");var n=e.slice(0,e.lastIndexOf("."));return exports.sign(n,t)==e?n:!1},exports.parseSignedCookies=function(e,t){var n={};return Object.keys(e).forEach(function(r){var i=e[r];0==i.indexOf("s:")&&(i=signature.unsign(i.slice(2),t),i&&(n[r]=i,delete e[r]))}),n},exports.parseSignedCookie=function(e,t){return 0==e.indexOf("s:")?signature.unsign(e.slice(2),t):e},exports.parseJSONCookies=function(e){return Object.keys(e).forEach(function(t){var n=e[t],r=exports.parseJSONCookie(n);r&&(e[t]=r)}),e},exports.parseJSONCookie=function(e){if(0==e.indexOf("j:"))try{return JSON.parse(e.slice(2))}catch(t){}},exports.pause=require("pause"),exports.removeContentHeaders=function(e){Object.keys(e._headers).forEach(function(t){0==t.indexOf("content")&&e.removeHeader(t)})},exports.conditionalGET=function(e){return e.headers["if-modified-since"]||e.headers["if-none-match"]},exports.unauthorized=function(e,t){e.statusCode=401,e.setHeader("WWW-Authenticate",'Basic realm="'+t+'"'),e.end("Unauthorized")},exports.notModified=function(e){exports.removeContentHeaders(e),e.statusCode=304,e.end()},exports.etag=function(e){return'"'+e.size+"-"+Number(e.mtime)+'"'},exports.parseCacheControl=function(e){for(var t=e.split(","),n={},r=0,i=t.length;i>r;r++){var o=t[r].split("="),a=o.shift().trim(),s=parseInt(o.shift(),10);n[a]=isNaN(s)?!0:s}return n},exports.parseUrl=function(e){var t=e._parsedUrl;return t&&t.href==e.url?t:e._parsedUrl=parse(e.url)},exports.parseBytes=require("bytes");