var EventEmitter=require("events").EventEmitter,Session=require("./session"),Cookie=require("./cookie"),Store=module.exports=function(){};Store.prototype.__proto__=EventEmitter.prototype,Store.prototype.regenerate=function(e,t){var n=this;this.destroy(e.sessionID,function(r){n.generate(e),t(r)})},Store.prototype.load=function(e,t){var n=this;this.get(e,function(r,i){if(r)return t(r);if(!i)return t();var o={sessionID:e,sessionStore:n};i=n.createSession(o,i),t(null,i)})},Store.prototype.createSession=function(e,t){var n=t.cookie.expires,r=t.cookie.originalMaxAge;return t.cookie=new Cookie(t.cookie),"string"==typeof n&&(t.cookie.expires=new Date(n)),t.cookie.originalMaxAge=r,e.session=new Session(e,t),e.session};