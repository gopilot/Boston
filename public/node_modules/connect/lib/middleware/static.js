var send=require("send"),utils=require("../utils"),parse=utils.parseUrl,url=require("url");exports=module.exports=function(e,t){if(t=t||{},!e)throw new Error("static() root path required");var n=!1===t.redirect?!1:!0;return function(r,i,o){function s(){o(),l.resume()}function a(){if(!n)return s();var e=url.parse(r.originalUrl).pathname;i.statusCode=301,i.setHeader("Location",e+"/"),i.end("Redirecting to "+utils.escape(e)+"/")}function u(e){return 404==e.status?s():(o(e),void 0)}if("GET"!=r.method&&"HEAD"!=r.method)return o();var c=parse(r).pathname,l=utils.pause(r);send(r,c).maxage(t.maxAge||0).root(e).hidden(t.hidden).on("error",u).on("directory",a).pipe(i)}},exports.mime=send.mime;