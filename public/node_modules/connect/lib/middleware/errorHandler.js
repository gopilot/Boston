var utils=require("../utils"),fs=require("fs"),env=process.env.NODE_ENV||"development";exports=module.exports=function(){return function(e,t,n){e.status&&(n.statusCode=e.status),n.statusCode<400&&(n.statusCode=500),"test"!=env&&console.error(e.stack);var r=t.headers.accept||"";if(~r.indexOf("html"))fs.readFile(__dirname+"/../public/style.css","utf8",function(t,r){fs.readFile(__dirname+"/../public/error.html","utf8",function(t,i){var o=(e.stack||"").split("\n").slice(1).map(function(e){return"<li>"+e+"</li>"}).join("");i=i.replace("{style}",r).replace("{stack}",o).replace("{title}",exports.title).replace("{statusCode}",n.statusCode).replace(/\{error\}/g,utils.escape(e.toString())),n.setHeader("Content-Type","text/html; charset=utf-8"),n.end(i)})});else if(~r.indexOf("json")){var i={message:e.message,stack:e.stack};for(var o in e)i[o]=e[o];var s=JSON.stringify({error:i});n.setHeader("Content-Type","application/json"),n.end(s)}else n.writeHead(n.statusCode,{"Content-Type":"text/plain"}),n.end(e.stack)}},exports.title="Connect";